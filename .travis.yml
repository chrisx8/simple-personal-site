services:
  - docker

before_install:
  - docker build -t chrisx8/simple-personal-site .
  - docker run -d -p 127.0.0.1:80:8000 --env-file site_config.example.env chrisx8/simple-personal-site gunicorn simple_personal_site:wsgi.application
  - docker ps -a

deploy:
  provider: script
  script: echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin && docker push chrisx8/simple-personal-site
  on:
    branch: master
